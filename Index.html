<script>
  // IGMG Hamburg (DE) ve Çevresi – Ramadan 1447 | 2026 (Iftar/Akşam)
  // Quelle: IGMG PDF stadt=20083
  // TZ: Europe/Berlin (Hamburg)
  const TZ = "Europe/Berlin";

  // Format: "YYYY-MM-DDTHH:MM:SS"
  const IFTAR_TIMES = [
    "2026-02-19T17:44:00",
    "2026-02-20T17:46:00",
    "2026-02-21T17:48:00",
    "2026-02-22T17:50:00",
    "2026-02-23T17:51:00",
    "2026-02-24T17:53:00",
    "2026-02-25T17:55:00",
    "2026-02-26T17:57:00",
    "2026-02-27T17:59:00",
    "2026-02-28T18:01:00",
    "2026-03-01T18:03:00",
    "2026-03-02T18:05:00",
    "2026-03-03T18:07:00",
    "2026-03-04T18:09:00",
    "2026-03-05T18:11:00",
    "2026-03-06T18:13:00",
    "2026-03-07T18:15:00",
    "2026-03-08T18:16:00",
    "2026-03-09T18:18:00",
    "2026-03-10T18:20:00",
    "2026-03-11T18:22:00",
    "2026-03-12T18:24:00",
    "2026-03-13T18:26:00",
    "2026-03-14T18:28:00",
    "2026-03-15T18:30:00",
    "2026-03-16T18:31:00",
    "2026-03-17T18:33:00",
    "2026-03-18T18:35:00",
    "2026-03-19T18:37:00"
  ];

  // Optional: Elemente, wenn du es anzeigen willst (sonst einfach weglassen)
  // <div id="nextIftarText"></div>
  // <audio id="ezan" src="ezan.mp3" preload="auto"></audio>
  let lastTriggeredTarget = null;

  function nowInTZms(timeZone) {
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone,
      year: "numeric", month: "2-digit", day: "2-digit",
      hour: "2-digit", minute: "2-digit", second: "2-digit",
      hour12: false
    }).formatToParts(new Date());

    const get = (t) => parts.find(p => p.type === t).value;
    const iso = `${get("year")}-${get("month")}-${get("day")}T${get("hour")}:${get("minute")}:${get("second")}`;
    return new Date(iso).getTime();
  }

  function findNextTarget(nowMs) {
    for (const t of IFTAR_TIMES) {
      const ms = new Date(t).getTime();
      if (ms > nowMs) return ms;
    }
    return null;
  }

  function formatTargetForHamburg(targetMs) {
    const d = new Date(targetMs);
    return new Intl.DateTimeFormat("de-DE", {
      timeZone: TZ,
      weekday: "short",
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    }).format(d);
  }

  function updateCountdown() {
    const nowMs = nowInTZms(TZ);
    const targetMs = findNextTarget(nowMs);

    if (!targetMs) {
      document.querySelector(".card").innerHTML =
        "<h1>Ramazan Mübarek!</h1><p>Keine weiteren Iftar-Zeiten in der Liste.</p>";
      return;
    }

    const diff = targetMs - nowMs;

    // Optional Anzeige des nächsten Iftar-Termins
    const elNext = document.getElementById("nextIftarText");
    if (elNext) elNext.textContent = "Nächster Iftar: " + formatTargetForHamburg(targetMs);

    if (diff <= 0) {
      // (Optional) Ezan/Audio triggern – Achtung: Autoplay kann je nach Browser blockiert sein
      // if (lastTriggeredTarget !== targetMs) {
      //   lastTriggeredTarget = targetMs;
      //   const audio = document.getElementById("ezan");
      //   if (audio) audio.play().catch(()=>{});
      // }
      return;
    }

    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
    const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const m = Math.floor((diff / (1000 * 60)) % 60);
    const s = Math.floor((diff / 1000) % 60);

    document.getElementById("d").innerText = d;
    document.getElementById("h").innerText = String(h).padStart(2, "0");
    document.getElementById("m").innerText = String(m).padStart(2, "0");
    document.getElementById("s").innerText = String(s).padStart(2, "0");
  }

  setInterval(updateCountdown, 1000);
  updateCountdown();
</script>
